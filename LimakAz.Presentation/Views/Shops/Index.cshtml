@inject ICategoryService categoryService;
@inject ICookieService cookieService;
@inject ICountryService countryService;
@{
    var language = await cookieService.GetSelectedLanguageTypeAsync();
    var categories = categoryService.GetAll(language);
    var countries = countryService.GetAll(language);
}

@{
    ViewData["Template"] = "Template2";
}
<!-- Main Start -->
<style>
    /* Default style for nav-link */
    .nav-link {
        font-weight: normal; /* Normal weight */
        color: black; /* Default text color */
        transition: color 0.3s, font-weight 0.3s; /* Smooth transitions */
    }

        /* Style for active nav-link */
        .nav-link.active {
            font-weight: bold; /* Bold text */
            color: gray; /* Gray color for active links */
            background-color: transparent; /* Ensure no background interference */
            border: none; /* Remove any border effects if applied by Bootstrap */
        }

</style>
<main id="main"
      style="background: url('@Url.Content("~/assets2/images/limak_bg.jpg")') no-repeat; background-size: 100%; background-position: top center;"
      class="bg-full">
    <div class="main-container">
        <!-- Currency -->
        <div class="shop">
            <div class="block">
                <div class="block-header">
                    <h2 class="block-title">MAĞAZALAR</h2>
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="index.html">Ana səhifə</a>
                        </li>
                        <li class="breadcrumb-item active">
                            <span>Mağazalar</span>
                        </li>
                    </ul>
                </div>
                <div class="block-body">
                    <div class="row">
                        <div class="col-md-4 col-lg-3 col-12">
                            <div class="card card-sidebar">
                                <ul class="nav flex-column">
                                    <li class="nav-item" data-target-item="all">
                                        <a href="#" class="nav-link active" data-category-id="0">
                                            <img src="https://res.cloudinary.com/dsclrbdnp/image/upload/v1735604470/LimakAz/yum7v6w5cs7n3hkyd7cw.png" alt="All Categories" style="width:18px; height:18px; margin-right:8px;">
                                            Bütün kateqoriyalar
                                        </a>
                                    </li>
                                    @foreach (var item in categories)
                                    {
                                        <li class="nav-item">
                                            <a href="#" class="nav-link" data-category-id="@item.Id">
                                                <img src="@item.LogoPath" alt="Clothes" style="width:18px; height:18px; margin-right:8px;">
                                                @item.CategoryDetails.FirstOrDefault()?.Name
                                            </a>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>

                        <div class="col-md-8 col-lg-9 col-12">
                            <div>
                                <ul id="headerList" class="nav nav nav-tabs card-tabs-nav">
                                    @foreach (var item in countries)
                                    {

                                        <li class="nav-item">
                                            <a href="#" class="nav-link" data-category-id="@item.Id">
                                                <img src="@item.ImagePath" alt="" style="border-radius:50%"
                                                     class="card-tabs-nav-icon">
                                                <span class="card-tabs-nav-title">
                                                    @item.CountryDetails.FirstOrDefault()?.Name
                                                </span>
                                            </a>
                                        </li>
                                    }
                                </ul>
                            </div>
                            <div class="store-list">
                                <div data-id="1" class="active active-tab tab-pane">
                                    <partial name="_ShopsPartial"></partial>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<!-- Main End -->

<script>
    document.addEventListener("DOMContentLoaded", () => { // Line 104
        let selectedCategoryId = null;
        let selectedCountryId = null;

        console.log(document.querySelectorAll(".nav-link[data-category-id]"));

        document.querySelectorAll(".nav-link[data-category-id]").forEach(link => { // Line 109
            link.addEventListener("click", (e) => { // Line 110
                e.preventDefault();
                console.log("Category clicked:", link.getAttribute("data-category-id"));

                // Remove 'active' class from previous selection
                document.querySelectorAll(".nav-link[data-category-id]").forEach(el => el.classList.remove("active"));

                // Mark the clicked link as active
                link.classList.add("active");

                // Get selected category ID
                selectedCategoryId = link.getAttribute("data-category-id");
                fetchShops(selectedCategoryId, selectedCountryId);
            }); // Missing closing brace for `link.addEventListener` (Line 122)

            // Handle country selection
            document.querySelectorAll(".nav-link[data-country-id]").forEach(link => { // Line 125
                link.addEventListener("click", (e) => { // Line 126
                    e.preventDefault();

                    console.log("Country clicked:", link.getAttribute("data-country-id"));
                    // Remove 'active' class from previous selection
                    document.querySelectorAll(".nav-link[data-country-id]").forEach(el => el.classList.remove("active"));

                    // Mark the clicked link as active
                    link.classList.add("active");

                    // Get selected country ID
                    selectedCountryId = link.getAttribute("data-country-id");
                    fetchShops(selectedCategoryId, selectedCountryId);
                }); // Correct closing brace for `link.addEventListener`
            }); // Correct closing brace for `country.forEach`

            function fetchShops(categoryId, countryId) { // Line 139
                if (!categoryId || !countryId) return;

                console.log(`Fetching shops for category: ${categoryId}, country: ${countryId}`);
                // Send a request to your backend
                fetch(`/GetShops?categoryId=${categoryId}&countryId=${countryId}`)
                    .then(response => response.json())
                    .then(data => displayShops(data))
                    .catch(error => console.error("Error fetching shops:", error));
            } // Correct closing brace for `fetchShops`

            function displayShops(data) { // Line 149
                console.log("Shops data:", data);
                // Implement this to update your UI with the fetched shops
            } // Correct closing brace for `displayShops`
        }); // Missing closing brace for `document.addEventListener` (Line 154)

</script>
